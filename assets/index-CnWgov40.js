(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(t){if(t.ep)return;t.ep=!0;const i=s(t);fetch(t.href,i)}})();class r{constructor(){this.API_KEY="366dd3342c5cf8478fd777c6a4d843e6",this.BASE_URL="https://api.themoviedb.org/3",this.POPULAR_URL=`${this.BASE_URL}/movie/popular?api_key=${this.API_KEY}&language=es-ES`,this.SEARCH_URL=`${this.BASE_URL}/search/movie?api_key=${this.API_KEY}&language=es-ES&query=`,this.currentPage=1,this.totalPages=1,this.lastSearchTerm="",this.moviesContainer=document.getElementById("movies-container"),this.searchInput=document.getElementById("search-input"),this.searchButton=document.getElementById("search-button"),this.prevButton=document.getElementById("prev-page"),this.nextButton=document.getElementById("next-page"),this.pageInfo=document.getElementById("page-info"),this.modal=document.getElementById("movie-modal"),this.closeModal=document.querySelector(".close-modal"),this.handleSearch=this.handleSearch.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.handlePrevPage=this.handlePrevPage.bind(this),this.handleNextPage=this.handleNextPage.bind(this),this.handleMovieClick=this.handleMovieClick.bind(this),this.closeMovieModal=this.closeMovieModal.bind(this),this.initializeEventListeners(),this.loadPopularMovies()}initializeEventListeners(){this.searchButton.addEventListener("click",this.handleSearch),this.searchInput.addEventListener("keypress",this.handleKeyPress),this.prevButton.addEventListener("click",this.handlePrevPage),this.nextButton.addEventListener("click",this.handleNextPage),this.closeModal.addEventListener("click",this.closeMovieModal),window.addEventListener("click",e=>{e.target===this.modal&&this.closeMovieModal()})}async fetchMovies(e){try{const s=await fetch(e);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const n=await s.json();this.totalPages=n.total_pages,this.updatePaginationControls(),this.displayMovies(n.results)}catch(s){this.handleError(s)}}async fetchMovieDetails(e){try{const s=`${this.BASE_URL}/movie/${e}?api_key=${this.API_KEY}&language=es-ES`,n=await fetch(s);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const t=await n.json();this.displayMovieDetails(t)}catch(s){console.error("Error al obtener detalles de la película:",s),alert("No se pudieron cargar los detalles de la película")}}displayMovieDetails(e){document.getElementById("modal-title").textContent=e.title,document.getElementById("modal-poster").src=e.poster_path?`https://image.tmdb.org/t/p/w500${e.poster_path}`:"https://via.placeholder.com/500x750?text=Sin+Imagen",document.getElementById("modal-release-date").textContent=new Date(e.release_date).toLocaleDateString("es-ES"),document.getElementById("modal-rating").textContent=e.vote_average.toFixed(1),document.getElementById("modal-duration").textContent=e.runtime||"N/A",document.getElementById("modal-overview").textContent=e.overview||"No hay sinopsis disponible";const s=document.getElementById("modal-genres");s.innerHTML="",e.genres&&e.genres.length>0?e.genres.forEach(n=>{const t=document.createElement("span");t.classList.add("genre-tag"),t.textContent=n.name,s.appendChild(t)}):s.textContent="Géneros no disponibles",this.modal.classList.add("show")}closeMovieModal(){this.modal.classList.remove("show")}async handleMovieClick(e){await this.fetchMovieDetails(e)}updatePaginationControls(){this.pageInfo.textContent=`Página ${this.currentPage} de ${this.totalPages}`,this.prevButton.disabled=this.currentPage===1,this.nextButton.disabled=this.currentPage===this.totalPages}handlePrevPage(){this.currentPage>1&&(this.currentPage--,this.loadCurrentPage())}handleNextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadCurrentPage())}loadCurrentPage(){const e=this.lastSearchTerm?`${this.SEARCH_URL}${encodeURIComponent(this.lastSearchTerm)}`:this.POPULAR_URL;this.fetchMovies(`${e}&page=${this.currentPage}`)}handleError(e){console.error("Error al obtener los datos:",e),this.moviesContainer.innerHTML=`
      <div class="error-message">
        Lo sentimos, ha ocurrido un error al cargar las películas. 
        Por favor, inténtelo de nuevo más tarde.
      </div>
    `}displayMovies(e){if(this.moviesContainer.innerHTML="",!e||e.length===0){this.displayNoResults();return}const s=document.createDocumentFragment();e.forEach(n=>{const t=this.createMovieElement(n);s.appendChild(t)}),this.moviesContainer.appendChild(s)}createMovieElement(e){const s=document.createElement("div");s.classList.add("movie");const n=e.poster_path?`https://image.tmdb.org/t/p/w500${e.poster_path}`:"https://via.placeholder.com/500x750?text=Sin+Imagen",t=document.createElement("img");t.src=n,t.alt=e.title,t.loading="lazy";const i=document.createElement("div");return i.classList.add("movie-title"),i.textContent=e.title,s.appendChild(t),s.appendChild(i),s.addEventListener("click",()=>this.handleMovieClick(e.id)),s}displayNoResults(){const e=document.createElement("div");e.classList.add("no-results"),e.textContent="No se encontraron películas",this.moviesContainer.appendChild(e)}handleSearch(){const e=this.searchInput.value.trim();if(this.lastSearchTerm=e,this.currentPage=1,e){const s=`${this.SEARCH_URL}${encodeURIComponent(e)}&page=${this.currentPage}`;this.fetchMovies(s)}else this.loadPopularMovies()}handleKeyPress(e){e.key==="Enter"&&this.handleSearch()}loadPopularMovies(){this.lastSearchTerm="",this.currentPage=1,this.fetchMovies(`${this.POPULAR_URL}&page=${this.currentPage}`)}}document.addEventListener("DOMContentLoaded",()=>{new r});
